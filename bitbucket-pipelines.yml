image: openjdk:18
clone:
  depth: full
pipelines:
  default:
  - step:
      name: build Java components
      caches:
      - gradle
      - gradlewrapper
      script:
        - ./gradlew build
        - ./gradlew net.tangly.erp.ui:installDist -Pvaadin.productionMode
      artifacts:
          - net.tangly.erp.ui/build/distributions/**
          - net.tangly.erp.ui/build/install/**
  - step:
        name: build docker image
        script:
            - docker login -u $DOCKER_HUB_USER -p $DOCKER_HUB_PASSWORD
            - docker build -t tanglyllc/tangly-erp:latest net.tangly.erp.ui/
            - docker push tanglyllc/tangly-erp:latest
        services:
            - docker
definitions:
  caches:
    gradlewrapper: ~/.gradle/wrapper
